name: Generate Client

on:
  workflow_dispatch:

jobs:
  generate-go-client:
    runs-on: ubuntu-latest
    name: Generate a Go client
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Configure Generator
        run: |
          echo 'gitRepoId: "resolution-api-go-client"' >> ./gen-config.yml
          echo 'gitUserId: "superlink-me"' >> ./gen-config.yml
          echo 'packageName: "ResolutionAPI"' >> ./gen-config.yml

      - name: Generate Client
        uses: openapi-generators/openapitools-generator-action@v1
        with:
          generator: go
          openapi-url: https://api.superlink.me/v1/resolve/docs/doc.json
          config-file: ./gen-config.yml

      - name: Push to Repo
        uses: cpina/github-action-push-to-another-repository@main
        env:
          API_TOKEN_GITHUB: ${{ secrets.API_TOKEN_GITHUB }}
        with:
          source-directory: 'go-client'
          destination-github-username: 'superlink-me'
          destination-repository-name: 'resolution-api-go-client'
          user-email: hhkelder+superlinkbot@gmail.com
          target-branch: main